=== Что такое сущность XML?

Сущность XML позволяет определять теги, которые будут заменены содержимым при анализе XML-документа. В целом существует три типа сущностей:

* внутренние сущности
* внешние сущности
* сущности параметров.

Сущность должна быть создана в определении типа документа (DTD), начнем с примера:

[role="lesson-image"]
image::images/xxe-parser.png[XML parser]

Как вы видите, после обработки XML-документа парсером, он заменит определенную сущность `js` на определенную константу "Jo Smith". Как вы видите, это имеет много преимуществ, так как вы можете изменить `js` в одном месте, например, на "John Smith".

В приложении Java XML может использоваться для передачи данных от клиента к серверу, мы все знакомы с JSON API, мы также можем использовать xml для передачи информации. Большую часть времени фреймворк автоматически заполняет объект Java на основе структуры xml, например:

[role="lesson-image"]
image::images/xxe-parser-java.png[XML parser]

=== Что такое XXE-инъекция?

Атака XML External Entity — это тип атаки на приложение, которое анализирует XML-вход. Эта атака происходит, когда XML-вход, содержащий ссылку на внешний объект, обрабатывается слабо настроенным XML-анализатором. Эта атака может привести к раскрытию конфиденциальных данных, отказу в обслуживании, подделке запросов на стороне сервера, сканированию портов с точки зрения машины, на которой находится анализатор, и другим системным воздействиям.

Атаки могут включать раскрытие локальных файлов, которые могут содержать конфиденциальные данные, такие как пароли или личные данные пользователя, с использованием схем file: или относительных путей в системном идентификаторе. Поскольку атака происходит относительно приложения, обрабатывающего XML-документ, злоумышленник может использовать это доверенное приложение для перехода к другим внутренним системам, возможно, раскрывая другой внутренний контент через http(s)-запросы или запуская CSRF-атаку на любые незащищенные внутренние службы. В некоторых ситуациях библиотека процессора XML, уязвимая к проблемам повреждения памяти на стороне клиента, может быть использована путем разыменования вредоносного URI, что может позволить выполнить произвольный код под учетной записью приложения. Другие атаки могут получить доступ к локальным ресурсам, которые могут не прекратить возвращать данные, что может повлиять на доступность приложения, если слишком много потоков или процессов не будут освобождены.

В целом мы можем выделить следующие виды атак XXE:

* Классические: в этом случае внешняя сущность включена в локальный DTD
* Слепые: в ответе не отображается вывод или ошибки
* Ошибка: попытка получить содержимое ресурса в сообщении об ошибке
